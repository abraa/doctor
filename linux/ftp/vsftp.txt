
2、vsftp 安装

2.1 安装 vsftpd 服务器

yum install -y vsftpd
chkconfig --add vsftpd
chkconfig vsftpd on

2.2 修改配置文件 /etc/vsftpd/vsftpd.conf

chroot_local_user=YES

2.3 创建ftp虚拟账号	

useradd -d /home -r -s /bin/nologin virftp

2.4 创建ftp登录虚拟账号密码文件 (暂时没成功我只能使用virftp登录)

 touch /etc/vsftpd/vsftpd_login
  文件内容为：(#号后面部分不要写入文件)
testuser1 #第一个ftp账号
111222aaa #第一个ftp密码
testuser2 #第二个ftp账号
123456    #第二个ftp账号密码

2.5、创建密码文件

db_load -T -t hash -f /etc/vsftpd/vsftpd_login /etc/vsftpd/vsftpd_login.db

2.6、创建vsftpd用户配置文件

创建目录 /etc/vsftpd/vsftpd_user_conf, 在该目录下，创建和用户名相同的文件，首先创建testuser1文件，内容如下：

# 账号访问的固定目录
local_root=/home/virftp/test1  
# 禁止匿名登录
anonymous_enable=NO
# 有可写权限
write_enable=YES
# 上传账号的umask
local_umask=002
# 可上传
anon_upload_enable=YES
# 可写
anon_mkdir_write_enable=YES
# 登录后，多久不操作 自动超时
idle_session_timeout=6000
# 链接超时时间
data_connection_timeout=300
# 最大客户端数
max_clients=5
# 最大ip书
max_per_ip=5

local_max_rate=500000

创建后，/etc/vsftpd 的目录机构

.
├── ftpusers
├── user_list
├── vsftpd.conf
├── vsftpd_conf_migrate.sh
├── vsftpd_login
├── vsftpd_login.db
└── vsftpd_user_conf
    └── testuser1

2.7、 修改配置文件 /etc/vsftpd/vsftpd.conf,内容如下：

anonymous_enable=NO		#不允许匿名登录
anon_upload_enable=NO		
anon_world_readable_only=NO
anon_mkdir_write_enable=NO
anon_other_write_enable=NO
chown_uploads=NO
anon_umask=077

chroot_local_user=YES
local_enable=YES
write_enable=YES
local_umask=002
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
xferlog_std_format=YES

pam_service_name=vsftpd
userlist_enable=NO
tcp_wrappers=YES
listen=YES
guest_enable=YES
guest_username=virftp
virtual_use_local_privs=yes
user_config_dir=/etc/vsftpd/vsftpd_user_conf

2.8、创建服务

启动成功后，可以通过 ftp客户端链接

 chkconfig --add vsftpd
 chkconfig vsftpd on
 service vsftpd start

2.9、授权非根目录下的目录给该账号访问

在 /home/virftp/test1 下创建 www目录 
mkdir -pv /home/virftp/test1/www 
执行命令： 
mount –bind /home/virftp/test1/www /data/www/ 
执行完成后，用ftp工具登录，就可以访问到非当前目录的文件。